[tools]
go = "1.24"
"aqua:golangci/golangci-lint" = "1.64.5"
"aqua:mvdan/gofumpt" = "0.7.0"
"go:golang.org/x/tools/gopls" = "latest"
lefthook = "1.11.5"
"npm:@anthropic-ai/claude-code" = "2.1.42"

[env]
GOFLAGS = "-mod=mod"

[tasks.fmt]
description = "Format Go code with gofumpt"
run = "gofumpt -l -w -extra ."

[tasks.lint]
description = "Run golangci-lint"
run = "golangci-lint run ./..."

[tasks.vet]
description = "Run go vet"
run = "go vet ./..."

[tasks.test]
description = "Run Go tests"
run = "go test -v -race -count=1 ./..."

[tasks.build]
description = "Build the application"
run = """
go build -ldflags="-s -w \
  -X github.com/open-cli-collective/cpm/internal/version.Version=dev \
  -X github.com/open-cli-collective/cpm/internal/version.Commit=$(git rev-parse --short HEAD) \
  -X github.com/open-cli-collective/cpm/internal/version.Date=$(date -u +%Y-%m-%dT%H:%M:%SZ) \
  -X github.com/open-cli-collective/cpm/internal/version.Branch=$(git rev-parse --abbrev-ref HEAD)" \
  -o cpm ./cmd/cpm
"""

[tasks.ci]
description = "Run all CI checks"
run = """
set -e
mise run fmt
mise run vet
mise run lint
mise run test
mise run build
"""

[settings]
task_output = "prefix"
